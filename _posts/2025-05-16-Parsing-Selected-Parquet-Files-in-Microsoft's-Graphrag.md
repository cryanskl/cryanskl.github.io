---
title: "Parsing Selected Parquet Files in Microsoft's Graphrag"
date: 2025-05-16 11:21:25 +0800
categories: [LLM]
tags: [rag, graphrag]
pin: false
---

## 0.GraphRag ç´¢å¼•è¿‡ç¨‹

![image-20250906115336753](../assets/typoraimg/image-20250906115336753.png)


```mermaid
flowchart TB
  %% åŸæ–‡ä¸åˆ‡å—å±‚
  subgraph RAW[åŸæ–‡ä¸åˆ‡å—å±‚]
    D[/documents.parquet<br/>æ–‡æ¡£çº§å…ƒä¿¡æ¯<br/>doc_id Â· æ ‡é¢˜ Â· æºæ–‡ä»¶ Â· é¡µèŒƒå›´ Â· æ ‡ç­¾/]
    TU[text_units.parquet<br/>æ–‡æœ¬/è¡¨æ ¼å•å…ƒ<br/>unit_id Â· doc_id Â· page_no<br/>text Â· token_count Â· section_path]
    D -->|é¡µç /æ¥æºè¿½æº¯| TU
  end

  %% çŸ¥è¯†å›¾è°±å±‚
  subgraph KG[çŸ¥è¯†å›¾è°±å±‚]
    E[entities.parquet<br/>å®ä½“è¡¨<br/>entity_id Â· name Â· type<br/>aliases Â· source_unit_ids]
    R[relationships.parquet<br/>å…³ç³»è¡¨<br/>rel_id Â· head Â· relation Â· tail<br/>source_unit_id]
    TU -->|NER/è¡¨æ ¼è§£æ/é”®å€¼æŠ½å–| E
    TU -->|å…³ç³»æŠ½å–| R
    E <-->|head/tail å…³è”| R
  end

  %% ç¤¾åŒºä¸æ€»ç»“å±‚
  subgraph COM[ç¤¾åŒºä¸æ€»ç»“å±‚]
    C[communities.parquet<br/>ç¤¾åŒºåˆ’åˆ†<br/>community_id Â· entity_id<br/>level Â· score]
    CR[community_reports.parquet<br/>ç¤¾åŒºæŠ¥å‘Š<br/>community_id Â· summary]
    E -->|å›¾è¿é€š/ç›¸ä¼¼åº¦èšç±»| C
    R -->|è¾¹æƒæ”¯æ’‘| C
    C -->|æŒ‰ç¤¾åŒºç”Ÿæˆ| CR
  end

  %% æŸ¥è¯¢ä¸å›æº¯
  Q([æŸ¥è¯¢/é—®é¢˜]) -->|å‘é‡æˆ–å›¾æ£€ç´¢| E
  Q -->|å‘é‡å¬å›| TU
  CR -->|ç¤¾åŒºçº§å®šä½/å¯¼èˆª| Q
  TU -->|å›æº¯åŸæ–‡é¡µç | D

```

# 1. `documents.parquet`

**ä½œç”¨**ï¼šå­˜å‚¨åŸå§‹æ–‡æ¡£çº§åˆ«çš„å…ƒä¿¡æ¯ã€‚

**ç”µå•†ç¤ºä¾‹**ï¼š

| doc_id | title                 | source_path     | page_start | page_end | meta_tags               |
| ------ | --------------------- | --------------- | ---------- | -------- | ----------------------- |
| D001   | 2025 æ™ºèƒ½é—¨é”äº§å“æ‰‹å†Œ | catalog2025.pdf | 1          | 150      | ["æ™ºèƒ½é—¨é”","äº§å“æ‰‹å†Œ"] |
| D002   | 2025 å……ç”µå®ç›®å½•       | catalog2025.pdf | 151        | 200      | ["å……ç”µå®","ç›®å½•"]       |

ğŸ‘‰ ç”¨æ¥è¿½æº¯ chunkã€å®ä½“ã€ç¤¾åŒºæ¥è‡ªå“ªä¸ª PDF æ–‡ä»¶ã€å“ªå‡ é¡µã€‚

------

# 2. `text_units.parquet`

**ä½œç”¨**ï¼šæŠŠ PDF åˆ‡åˆ†åçš„ **chunk/å¥å­/è¡¨æ ¼å•å…ƒ**å­˜å‚¨ä¸‹æ¥ï¼Œå¸¦æ–‡æ¡£å’Œä½ç½®ã€‚

**ç”µå•†ç¤ºä¾‹**ï¼š

| unit_id | doc_id | page_no | text                                               | token_count | section_path                   |
| ------- | ------ | ------- | -------------------------------------------------- | ----------- | ------------------------------ |
| U1001   | D001   | 12      | "SL-200 å‹å·æ”¯æŒæŒ‡çº¹è§£é”ï¼Œç”µæ± ç»­èˆªçº¦ 12 ä¸ªæœˆã€‚"    | 24          | "æ™ºèƒ½é—¨é” > æŒ‡çº¹ç³»åˆ— > SL-200" |
| U1002   | D001   | 13      | "SL-210 å‹å·å¢åŠ è“ç‰™è¿æ¥åŠŸèƒ½ï¼Œå…¼å®¹æ‰‹æœº App æ§åˆ¶ã€‚" | 30          | "æ™ºèƒ½é—¨é” > è“ç‰™ç³»åˆ— > SL-210" |
| U2001   | D002   | 160     | "PB-100 å……ç”µå®å®¹é‡ 20,000mAhï¼Œæ”¯æŒ 65W å¿«å……ã€‚"     | 22          | "å……ç”µå® > é«˜å®¹é‡ç³»åˆ— > PB-100" |

ğŸ‘‰ GraphRAG åœ¨è¿™ä¸€å±‚ä¸Šåš **å®ä½“æŠ½å–**ã€‚

------

# 3. `entities.parquet`

**ä½œç”¨**ï¼šæ‰€æœ‰è¯†åˆ«å‡ºçš„å®ä½“ï¼Œå¸¦å½’ä¸€åŒ–ã€åˆ«åã€æ¥æºã€‚

**ç”µå•†ç¤ºä¾‹**ï¼š

| entity_id | name     | type      | aliases                     | source_unit_ids |
| --------- | -------- | --------- | --------------------------- | --------------- |
| E001      | SL-200   | Product   | ["æ™ºèƒ½é—¨é” SL200", "SL200"] | [U1001]         |
| E002      | æŒ‡çº¹è§£é” | Feature   | ["æŒ‡çº¹è¯†åˆ«"]                | [U1001]         |
| E003      | ç”µæ± ç»­èˆª | Attribute | ["Battery Life"]            | [U1001]         |
| E004      | 12 ä¸ªæœˆ  | Value     | ["ä¸€å¹´"]                    | [U1001]         |

ğŸ‘‰ **GraphRAG çš„å…³é”®èµ„äº§**ï¼Œç”¨äºå»ºå›¾å’Œç¤¾åŒºå‘ç°ã€‚

------

# 4. `relationships.parquet`

**ä½œç”¨**ï¼šå®ä½“ä¹‹é—´çš„è¾¹ï¼ˆå…³ç³»ï¼‰ï¼Œè®°å½•æ¥æºã€‚

**ç”µå•†ç¤ºä¾‹**ï¼š

| rel_id | head_entity | relation    | tail_entity | source_unit_id |
| ------ | ----------- | ----------- | ----------- | -------------- |
| R001   | SL-200      | has_feature | æŒ‡çº¹è§£é”    | U1001          |
| R002   | SL-200      | has_attr    | ç”µæ± ç»­èˆª    | U1001          |
| R003   | ç”µæ± ç»­èˆª    | value       | 12 ä¸ªæœˆ     | U1001          |
| R004   | SL-210      | has_feature | è“ç‰™è¿æ¥    | U1002          |

ğŸ‘‰ æ„æˆ **çŸ¥è¯†å›¾è°±**ï¼šäº§å“ â†” åŠŸèƒ½/å±æ€§ â†” å‚æ•°å€¼ã€‚

------

# 5. `communities.parquet`

**ä½œç”¨**ï¼šå›¾åˆ’åˆ†ç»“æœï¼Œè¡¨ç¤ºæ¯ä¸ªå®ä½“å±äºå“ªä¸ªç¤¾åŒºï¼ˆç°‡ï¼‰ã€‚

**ç”µå•†ç¤ºä¾‹**ï¼š

| community_id | entity_id | level | score |
| ------------ | --------- | ----- | ----- |
| C01          | SL-200    | 2     | 0.92  |
| C01          | SL-210    | 2     | 0.89  |
| C01          | æŒ‡çº¹è§£é”  | 2     | 0.75  |
| C01          | è“ç‰™è¿æ¥  | 2     | 0.78  |
| C02          | PB-100    | 2     | 0.94  |
| C02          | å¿«å……      | 2     | 0.83  |

ğŸ‘‰ C01 ç¤¾åŒº â‰ˆ â€œæ™ºèƒ½é—¨é”ç³»åˆ—â€ï¼Œ
 C02 ç¤¾åŒº â‰ˆ â€œé«˜å®¹é‡å……ç”µå®ç³»åˆ—â€ã€‚

------

# 6. `community_reports.parquet`

**ä½œç”¨**ï¼šä¸ºæ¯ä¸ªç¤¾åŒºç”Ÿæˆçš„æ€»ç»“ï¼ˆLLM äº§ç‰©ï¼‰ã€‚

**ç”µå•†ç¤ºä¾‹**ï¼š

| community_id | summary                                                      |
| ------------ | ------------------------------------------------------------ |
| C01          | "æ™ºèƒ½é—¨é”ç³»åˆ—åŒ…æ‹¬ SL-200 å’Œ SL-210ã€‚SL-200 æä¾›æŒ‡çº¹è§£é”ï¼Œç”µæ± ç»­èˆª 12 ä¸ªæœˆï¼›SL-210 å¢åŠ è“ç‰™åŠŸèƒ½ï¼Œå¯ç”¨æ‰‹æœº App æ§åˆ¶ã€‚æ•´ä½“é€‚åˆå®¶åº­ç”¨æˆ·ï¼Œå¼ºè°ƒä¾¿åˆ©ä¸å®‰å…¨ã€‚" |
| C02          | "é«˜å®¹é‡å……ç”µå®ç³»åˆ— PB-100 ä¸»æ‰“ 20,000mAh å¤§å®¹é‡å’Œ 65W å¿«å……ï¼Œé€‚åˆå•†åŠ¡å’Œæ—…è¡Œç”¨æˆ·ã€‚" |

ğŸ‘‰ æ£€ç´¢æ—¶ï¼šå…ˆæ‰¾åˆ°ç¤¾åŒº â†’ ç”¨ summary å¸®ç”¨æˆ·å¿«é€Ÿå®šä½ï¼Œå†ä¸‹é’»åˆ°å…·ä½“å®ä½“/æ–‡æœ¬ã€‚
