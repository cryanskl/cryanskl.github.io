---
title: "Automated Script for Static Website Submission"
date: 2024-12-04 16:57:35 +0800
categories: [Lab]
tags: [website, script]
pin: false
---

## deploy.bat

å†™äº†ä¸€ä¸ªdeploy.bat, æœ¬åœ°æ„å»ºå¥½Jekyllåå¢é‡ä¸Šä¼ åˆ°é˜¿é‡ŒOSS, å¹¶ä¸”åˆ·æ–°é˜¿é‡Œäº‘ç¼“å­˜

### ğŸ§© æ‰€éœ€å·¥å…·ä¸ç¯å¢ƒé…ç½®

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆå®‰è£…å¹¶é…ç½®ä»¥ä¸‹å·¥å…·ï¼š

| å·¥å…·                          | ä½œç”¨                                   | å®‰è£…åœ°å€æˆ–å‘½ä»¤                                   |
| ----------------------------- | -------------------------------------- | ------------------------------------------------ |
| Ruby + Jekyll                 | ç”¨äºæ„å»ºåšå®¢                           | Jekyll å®‰è£…æ•™ç¨‹                                  |
| Bundler                       | Ruby ä¾èµ–ç®¡ç†å™¨                        | `gem install bundler`                            |
| é˜¿é‡Œäº‘ OSS å·¥å…·ï¼ˆossutilï¼‰    | ä¸Šä¼ æ–‡ä»¶åˆ°é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨               | å®˜æ–¹æ–‡æ¡£                                         |
| é˜¿é‡Œäº‘ CLI å·¥å…·ï¼ˆaliyun-cliï¼‰ | è°ƒç”¨ CDN æ¥å£                          | å®˜æ–¹æ–‡æ¡£                                         |
| Pythonï¼ˆå¯é€‰ï¼‰                | ç”¨äºå¤„ç†æ–‡ä»¶åä¸ Front Matter æ—¥æœŸå¯¹é½ | [Python å®˜ç½‘](https://www.python.org/downloads/) |

å®‰è£…å®Œæˆåï¼š

- é…ç½® ossutilï¼ˆè¿è¡Œä¸€æ¬¡ `ossutil64 config`ï¼‰
- é…ç½® aliyun CLIï¼ˆè¿è¡Œä¸€æ¬¡ `aliyun configure`ï¼‰

------

### ğŸ“ è„šæœ¬ç»“æ„è¯´æ˜

#### âœ… 1. Python é¢„å¤„ç†éƒ¨åˆ†ï¼ˆfix_post_filename.pyï¼‰

ä½œç”¨ï¼šç¡®ä¿ `_posts/` ä¸­çš„ Markdown æ–‡ä»¶åæ—¥æœŸä¸ Front Matter ä¸­ä¸€è‡´ï¼Œé˜²æ­¢ Jekyll æŠ¥é”™æˆ–æ–‡ç« æ— æ³•æ¸²æŸ“ã€‚

å…³é”®é€»è¾‘ï¼š

```
pythonCopyEdit# è¯»å–æ–‡ä»¶åå’Œç¬¬ä¸‰è¡Œ frontmatter ä¸­çš„æ—¥æœŸæ˜¯å¦ä¸€è‡´
# è‹¥ä¸ä¸€è‡´ï¼Œåˆ™è‡ªåŠ¨é‡å‘½åæ–‡ä»¶
```

#### âœ… 2. Jekyll æ„å»º

```
bat


CopyEdit
call bundle exec jekyll build
```

åœ¨å½“å‰ç›®å½•ä¸‹æ„å»ºç”Ÿæˆ `_site/` æ–‡ä»¶å¤¹ï¼Œå³ç½‘ç«™é™æ€å†…å®¹ã€‚

#### âœ… 3. å¢é‡ä¸Šä¼ è‡³ OSS

```
bat


CopyEdit
ossutil64 sync D:\GitBlog\_site oss://osspath -u --delete
```

- `-u`ï¼šä»…ä¸Šä¼ å˜æ›´è¿‡çš„æ–‡ä»¶ï¼ˆ**å¢é‡ä¸Šä¼ **ï¼‰
- `--delete`ï¼šè‡ªåŠ¨åˆ é™¤ OSS ä¸Šå·²è¢«æœ¬åœ°åˆ é™¤çš„æ–‡ä»¶

#### âœ… 4. åˆ·æ–° CDN ç¼“å­˜

```
bat


CopyEdit
aliyun cdn RefreshObjectCaches --ObjectPath "https://yourosspath.aliyuncs.com/*" --ObjectType File
```

é˜²æ­¢ç”¨æˆ·è®¿é—®çš„æ˜¯ç¼“å­˜é¡µé¢ï¼Œè€Œä¸æ˜¯åˆšåˆšä¸Šä¼ çš„æ–°ç‰ˆæœ¬ã€‚

------

### ğŸ¯ ä½¿ç”¨æ–¹æ³•

1. å°† `.bat` è„šæœ¬æ–‡ä»¶æ”¾åˆ°æ¡Œé¢
2. å°† `fix_post_filename.py` æ”¾å…¥åšå®¢æ ¹ç›®å½•ï¼ˆå¦‚ `D:\GitBlog`ï¼‰
3. åŒå‡» `.bat` è„šæœ¬ï¼Œå³å¯å®Œæˆå…¨æµç¨‹éƒ¨ç½²

å»ºè®®æ–‡ä»¶ç»“æ„ï¼š

```
makefileCopyEditD:\GitBlog\
â”‚
â”œâ”€â”€ _posts\
â”œâ”€â”€ _site\
â”œâ”€â”€ fix_post_filename.py
â””â”€â”€ blog_sync.bat
```

------

### ğŸ’¡ å¸¸è§é—®é¢˜

#### ğŸ“Œ ä¸ºä»€ä¹ˆä¸Šä¼ æ—¶æœ‰å¾ˆå¤šæ–‡ä»¶å˜åŒ–ï¼Ÿ

è¯·ç¡®è®¤ Jekyll æ²¡æœ‰ç”Ÿæˆ `.DS_Store`ã€`.sass-cache`ã€æˆ– `.jekyll-cache` ç­‰æ–‡ä»¶ã€‚å¦‚æœè¿™äº›æ–‡ä»¶åœ¨ `_site` ç›®å½•ä¸­å­˜åœ¨ï¼Œå¯ä»¥åœ¨ `.gitignore` å’Œ Jekyll é…ç½®ä¸­æ’é™¤å®ƒä»¬ã€‚

#### ğŸ“Œ aliyun å‘½ä»¤æ— æ³•è¯†åˆ«ï¼Ÿ

è¯·ç¡®ä¿ `aliyun.exe` æ‰€åœ¨ç›®å½•å·²æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ `Path`ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ `.bat` ä¸­å†™æ­»è·¯å¾„ï¼Œå¦‚ï¼š

```
bat


CopyEdit
"D:\Tools\aliyun-clipath" ...
```

------

### ğŸ§­ æ‹“å±•å»ºè®®

- æ·»åŠ  **è‡ªåŠ¨å¤‡ä»½**ï¼Œå¦‚ zip æ‰“åŒ… `_posts` å’Œ `_config.yml`
- ä½¿ç”¨ GitHub Actions æˆ– Azure DevOps åšè¿œç¨‹è‡ªåŠ¨éƒ¨ç½²
- åŠ å…¥ `jekyll serve` è‡ªåŠ¨é¢„è§ˆåŠŸèƒ½

------

### âœ… æ€»ç»“

é€šè¿‡è¿™ä¸ªè„šæœ¬ï¼Œæˆ‘ä»¬å®ç°äº†ä» Markdown ç¼–å†™åˆ°ç½‘é¡µä¸Šçº¿çš„ã€Œä¸€é”®å¼éƒ¨ç½²ã€ã€‚å¯¹åšä¸»è€Œè¨€ï¼Œè¿™æ„å‘³ç€æ›´é«˜æ•ˆçš„å†…å®¹è¿­ä»£ã€æ›´å°‘çš„æ“ä½œå‡ºé”™ï¼Œä»¥åŠæ›´å¿«çš„å‘å¸ƒé€Ÿåº¦ã€‚

## è¡¥å……

å®Œæ•´è„šæœ¬å¦‚ä¸‹

```bat
@echo off
chcp 65001 > nul
title ğŸš€ è‡ªåŠ¨éƒ¨ç½² Jekyll åšå®¢è‡³ OSS
echo ===============================
echo ğŸ› ï¸ æ­£åœ¨æ„å»º Jekyll ç½‘ç«™...
echo ===============================
cd /d %~dp0

call bundle exec jekyll build

echo.
echo ===============================
echo â˜ï¸ æ­£åœ¨å¢é‡ä¸Šä¼ è‡³é˜¿é‡Œäº‘ OSS...
echo ===============================

ossutil64 sync "%~dp0_site" oss://youross -u --delete

echo.
echo ===============================
echo âš¡ æ­£åœ¨åˆ·æ–°é˜¿é‡Œäº‘ CDN ç¼“å­˜...
echo ===============================

aliyun cdn RefreshObjectCaches --ObjectPath "https://youross*" --ObjectType File

echo.
echo âœ… æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼
pause

```

